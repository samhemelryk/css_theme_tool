YUI.add("moodle-block_css_theme_tool-csseditor-colourpicker",function(e,t){var n=function(e){n.superclass.constructor.apply(this,arguments)};n.prototype={box:null,dialogue:null,overlay:null,currentcolour:null,overlayshown:!1,cssbuilder:null,cssstyle:null,width:384,height:128,factor:4,events:{mouseenter:null,click:null,mousemove:null,mouseleave:null},initializer:function(t){this.cssbuilder=t.cssbuilder,this.currentcolour="#FFFFFF",this.cssstyle=t.cssstyle,this.box=new e.Overlay({headerContent:'<h2 class="header">'+M.str.block_css_theme_tool.colourpickertitle+'</h2><div class="close"></div>',bodyContent:'<div class="colorpickerdialogueoverlay"></div><div class="previouscolours"></div>',centered:!0,visible:!1,zIndex:4500}),this.box.render(e.one(document.body)),this.box.get("boundingBox").one(".close").on("click",this.hide,this),this.dialogue=this.box.get("boundingBox").addClass("ctt-colourpicker").one(".colorpickerdialogueoverlay"),this.dialogue.setStyle("backgroundImage","url("+M.cfg.wwwroot+"/blocks/css_theme_tool/colourpicker_image.php)"),this.dialogue.on("click",this.pick_colour,this),this.dialogue.on("mouseenter",this.start_follow,this),this.dialogue.on("mouseleave",this.stop_follow,this),this.overlay=new e.Overlay({bodyContent:" ",width:"50px",height:"50px",centered:!1,visible:!1,zIndex:4600}),this.overlay.render(e.one(document.body)),this.overlay.bodyNode.addClass("colourpicker_preview"),t.button.on("click",this.show,this);var n=e.Cookie.get("cttpreviouscolours");if(n&&M.block_css_theme_tool.previouscolours.length==0){n=n.split(";");var r=this.box.get("boundingBox").one(".previouscolours");for(var i in n){var s=e.Node.create('<div class="previouscolour"></div>').setStyle("backgroundColor",n[i]);s.on("click",this.pick_previous_colour,this,n[i]),r.append(s)}M.block_css_theme_tool.previouscolours=n}},display_color:function(e){this.overlay.move(e.pageX+10,e.pageY+10),this.currentcolour=this.determine_colour(e),this.overlay.bodyNode.setStyle("backgroundColor",this.currentcolour)},start_follow:function(e){this.events.mousemove&&this.events.mousemove.detach(),this.overlay.show(),this.overlayshown=!0,this.events.mousemove=this.dialogue.on("mousemove",this.display_color,this),this.display_color(e)},stop_follow:function(){this.overlay.hide(),this.overlayshown=!1,this.events.mousemove.detach()},determine_colour:function(e){if(!e.target)return;var t=Math.floor(e.pageX-e.target.getX()),n=Math.floor(e.pageY-e.target.getY()),r=this.width,i=this.height,s=this.factor,o=[255,0,0],u=[[0,1,0],[-1,0,0],[0,0,1],[0,-1,0],[1,0,0],[0,0,-1]],a=u.length,f=Math.round(r/a),l=Math.round(i/2);for(var c=0;c<r;c++){var h=Math.floor(c/f),p=u[h];o[0]+=p[0]*s,o[1]+=p[1]*s,o[2]+=p[2]*s;if(t==c)break}var d=[o[0],o[1],o[2]];return n<l-1?(d[0]+=Math.floor((255-d[0])/l*(l-n)),d[1]+=Math.floor((255-d[1])/l*(l-n)),d[2]+=Math.floor((255-d[2])/l*(l-n))):n>l+1&&(d[0]=Math.floor((i-n)*(d[0]/l)),d[1]=Math.floor((i-n)*(d[1]/l)),d[2]=Math.floor((i-n)*(d[2]/l))),this.convert_rgb_to_hex(d)},pick_colour:function(e){this.stop_follow(),this.cssbuilder.manual_add_style(this.cssstyle+": "+this.currentcolour),this.set_current_colour(this.currentcolour),this.hide()},pick_previous_colour:function(e,t){this.stop_follow(),this.cssbuilder.manual_add_style(this.cssstyle+": "+t),this.hide()},set_current_colour:function(t){var n=M.block_css_theme_tool.previouscolours;if(t){n.push(t);var r=this.box.get("boundingBox").one(".previouscolours"),i=e.Node.create('<div class="previouscolour"></div>').setStyle("backgroundColor",t);i.on("click",this.pick_previous_colour,this,t),r.append(i);if(n.length>20)while(n.length>20)n.shift(),r.one(".previouscolour").remove()}e.Cookie.set("cttpreviouscolours",n.join(";"),{expires:new Date("January 12, 2025")})},show:function(e){this.box.show()},hide:function(){this.overlay.hide(),this.overlayshown=!1,this.box.hide()},convert_rgb_to_hex:function(e){var t="#",n="0123456789ABCDEF";for(var r=0;r<3;r++){var i=Math.abs(e[r]);i==0||isNaN(i)?t+="00":t+=n.charAt((i-i%16)/16)+n.charAt(i%16)}return t}},e.extend(n,e.Base,n.prototype,{NAME:"moodle-block_css_theme_tool-csseditor-colourpicker",ATTRS:{}}),e.augment(n,e.EventTarget),M.block_css_theme_tool.init_colour_picker=function(e){return new n(e)},M.block_css_theme_tool.previouscolours=[]},"@VERSION@",{requires:["moodle-block_css_theme_tool-csseditor","cookie"]});
